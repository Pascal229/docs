"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[53855],{63849:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"authorization/role-based-access-control/protect-api-resources-with-rbac","title":"Prot\xe9ger les ressources API avec le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC)","description":"En plus de Prot\xe9ger votre API qui s\xe9curise les ressources en s\'assurant qu\'un JWT valide est pr\xe9sent, le contr\xf4le d\'acc\xe8s bas\xe9 sur les r\xf4les (RBAC) peut \xe9galement \xeatre appliqu\xe9.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/authorization/role-based-access-control/protect-api-resources-with-rbac.mdx","sourceDirName":"authorization/role-based-access-control","slug":"/authorization/role-based-access-control/protect-api-resources-with-rbac","permalink":"/fr/authorization/role-based-access-control/protect-api-resources-with-rbac","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/authorization/role-based-access-control/protect-api-resources-with-rbac.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Configurer les r\xf4les","permalink":"/fr/authorization/role-based-access-control/configure-roles"},"next":{"title":"Mod\xe8le d\'organisation","permalink":"/fr/authorization/organization-template/"}}');var r=t(86070),i=t(15658);const o={sidebar_position:3},a="Prot\xe9ger les ressources API avec le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC)",l={},u=[{value:"Diagramme de flux d&#39;autorisation",id:"diagramme-de-flux-dautorisation",level:2},{value:"Optionnel : G\xe9rer le changement de permission utilisateur",id:"optionnel--g\xe9rer-le-changement-de-permission-utilisateur",level:2},{value:"Aucune nouvelle permission introduite dans le syst\xe8me",id:"aucune-nouvelle-permission-introduite-dans-le-syst\xe8me",level:3},{value:"Nouvelle permission introduite dans le syst\xe8me et attribu\xe9e \xe0 un utilisateur",id:"nouvelle-permission-introduite-dans-le-syst\xe8me-et-attribu\xe9e-\xe0-un-utilisateur",level:3}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"prot\xe9ger-les-ressources-api-avec-le-contr\xf4le-dacc\xe8s-bas\xe9-sur-les-r\xf4les-rbac",children:"Prot\xe9ger les ressources API avec le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC)"})}),"\n",(0,r.jsxs)(s.p,{children:["En plus de ",(0,r.jsx)(s.a,{href:"/authorization/api-resources/protect-your-api",children:"Prot\xe9ger votre API"})," qui s\xe9curise les ressources en s'assurant qu'un JWT valide est pr\xe9sent, le contr\xf4le d'acc\xe8s bas\xe9 sur les r\xf4les (RBAC) peut \xe9galement \xeatre appliqu\xe9."]}),"\n",(0,r.jsx)(s.p,{children:"Dans cet article, nous nous concentrerons sur la fa\xe7on dont le RBAC affecte la d\xe9l\xe9gation et la validation des port\xe9es dans votre flux d'authentification."}),"\n",(0,r.jsx)(s.h2,{id:"diagramme-de-flux-dautorisation",children:"Diagramme de flux d'autorisation"}),"\n",(0,r.jsx)(s.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Logto\n    participant API\n\n    Note over Client,API: Authentification & Requ\xeate de jeton\n    Client->>Logto: GET /oidc/auth & POST /oidc/token\n    Note right of Client: avec ressource et port\xe9es demand\xe9es\n\n    Note over Logto: Filtrer les port\xe9es demand\xe9es en fonction de<br/>la politique RBAC de l'utilisateur\n    Logto--\x3e>Client: Retourne le jeton d\u2019acc\xe8s JWT\n    Note left of Logto: Le jeton contient :<br/>- Revendications JWT standard<br/>- Port\xe9es accord\xe9es (filtr\xe9es par RBAC)\n\n    Note over Client,API: Requ\xeate API\n    Client->>API: Requ\xeate avec jeton Bearer\n\n    Note over API: Valider le jeton JWT :<br/>- Validation JWT standard<br/>- V\xe9rifier les port\xe9es accord\xe9es\n\n    alt Jeton invalide\n        API--\x3e>Client: 401 Non autoris\xe9\n    else Jeton valide\n        alt Port\xe9es requises non dans les port\xe9es accord\xe9es\n            API--\x3e>Client: 403 Interdit\n        else A les port\xe9es requises\n            API--\x3e>Client: Ressource prot\xe9g\xe9e\n        end\n    end"}),"\n",(0,r.jsx)(s.p,{children:"Comme vous pouvez le voir sur le diagramme, la principale diff\xe9rence par rapport \xe0 la protection API de base est la gestion des port\xe9es. Au lieu d'accorder directement toutes les port\xe9es demand\xe9es, Logto les filtre d\xe9sormais en fonction de la politique RBAC de l'utilisateur. Le jeton JWT ne contiendra que les port\xe9es que l'utilisateur a obtenues gr\xe2ce \xe0 ses r\xf4les. C\xf4t\xe9 API, apr\xe8s avoir valid\xe9 l'authenticit\xe9 du jeton, il y a une v\xe9rification suppl\xe9mentaire pour s'assurer que le jeton contient les port\xe9es requises pour la ressource demand\xe9e."}),"\n",(0,r.jsx)(s.h2,{id:"optionnel--g\xe9rer-le-changement-de-permission-utilisateur",children:"Optionnel : G\xe9rer le changement de permission utilisateur"}),"\n",(0,r.jsx)(s.p,{children:"Les permissions utilisateur peuvent \xeatre modifi\xe9es pendant une session -- par exemple, de nouveaux r\xf4les peuvent leur \xeatre attribu\xe9s ou les permissions de r\xf4le existantes peuvent \xeatre modifi\xe9es. Dans ces sc\xe9narios, d\xe9tecter ces changements et mettre \xe0 jour l'interface utilisateur de l'application peut \xeatre n\xe9cessaire."}),"\n",(0,r.jsx)(s.p,{children:"Que se passe-t-il lorsque les permissions d'un utilisateur changent ? Il y a deux cas."}),"\n",(0,r.jsx)(s.h3,{id:"aucune-nouvelle-permission-introduite-dans-le-syst\xe8me",children:"Aucune nouvelle permission introduite dans le syst\xe8me"}),"\n",(0,r.jsx)(s.p,{children:"Les jetons d\u2019acc\xe8s actuels resteront valides jusqu'\xe0 leur expiration, m\xeame apr\xe8s que les permissions d'un utilisateur aient \xe9t\xe9 modifi\xe9es. Cependant, les nouvelles permissions seront refl\xe9t\xe9es dans les jetons d\u2019acc\xe8s ult\xe9rieurs, et toutes les permissions r\xe9voqu\xe9es seront omises."}),"\n",(0,r.jsxs)(s.p,{children:["Voici quelques ",(0,r.jsx)(s.strong,{children:"actions recommand\xe9es"})," :"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Option 1 : Utiliser des temps d'expiration de jeton d\u2019acc\xe8s courts"})}),"\n",(0,r.jsxs)(s.p,{children:["Les jetons d\u2019acc\xe8s de courte dur\xe9e garantissent des mises \xe0 jour plus fr\xe9quentes des permissions utilisateur. Configurez les param\xe8tres d'expiration des jetons dans les param\xe8tres de ",(0,r.jsx)(s.a,{href:"/authorization/api-resources/#logto-api-resource-schema",children:"Ressource API"})," de la Console. L'inconv\xe9nient est que cela augmentera votre utilisation de jetons."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Option 2 : V\xe9rifier dynamiquement les permissions"})}),"\n",(0,r.jsxs)(s.p,{children:["Appelez p\xe9riodiquement les points de terminaison de ",(0,r.jsx)(s.a,{href:"/integrate-logto/interact-with-management-api",children:"Logto Management API"})," (par exemple, SWR) ou utilisez des techniques telles que WebSocket pour impl\xe9menter des connexions de longue dur\xe9e pour r\xe9cup\xe9rer dynamiquement les permissions utilisateur. Lors de la d\xe9tection de changements, effacez le jeton d\u2019acc\xe8s existant et les nouveaux jetons \xe9mis refl\xe9teront automatiquement les changements de port\xe9e de permission. - API : User-role - API : Role-permission"]}),"\n",(0,r.jsxs)(s.p,{children:["Lorsqu'un changement de permission est d\xe9tect\xe9, effacez d'abord le jeton d\u2019acc\xe8s du stockage, puis appelez la m\xe9thode SDK ",(0,r.jsx)(s.code,{children:"getAccessToken()"})," pour en acqu\xe9rir un nouveau. Le nouveau jeton d\u2019acc\xe8s \xe9mis devrait refl\xe9ter les changements de permission."]}),"\n",(0,r.jsx)(s.h3,{id:"nouvelle-permission-introduite-dans-le-syst\xe8me-et-attribu\xe9e-\xe0-un-utilisateur",children:"Nouvelle permission introduite dans le syst\xe8me et attribu\xe9e \xe0 un utilisateur"}),"\n",(0,r.jsx)(s.p,{children:"Cela se produit lorsque de nouvelles permissions sont introduites dans votre syst\xe8me. Dans ce cas, vous devrez d'abord inclure les nouvelles port\xe9es de permission introduites lors de l'initialisation du client Logto. Par exemple :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:"new LogtoClient({\n  appId: 'your-app-id',\n  redirectUrl: 'your-redirect-url',\n  resources: ['your-api-resource'],\n  scopes: [\n    // ... vos port\xe9es de permission existantes,\n    'new-scope',\n  ],\n});\n"})}),"\n",(0,r.jsx)(s.p,{children:"Deuxi\xe8mement, chacune de vos applications clientes doit re-consentir ou reconnecter les utilisateurs afin de recevoir le changement de permission. Ensuite, la nouvelle port\xe9e de permission sera refl\xe9t\xe9e dans les nouveaux jetons d\u2019acc\xe8s."}),"\n",(0,r.jsx)(s.p,{children:"Exemple de code pour re-consentir :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:"signIn({ redirectUrl: 'your-redirect-url', prompt: 'consent' });\n"})})]})}function d(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},15658:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>a});var n=t(30758);const r={},i=n.createContext(r);function o(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);