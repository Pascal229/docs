"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[96352],{7359:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"authorization/api-resources/node-express","title":"Guide : Node (Express)","description":"\xc9tape 1 : Extraire le jeton Bearer de l\'en-t\xeate de la requ\xeate","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/authorization/api-resources/node-express.mdx","sourceDirName":"authorization/api-resources","slug":"/authorization/api-resources/node-express","permalink":"/fr/authorization/api-resources/node-express","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/authorization/api-resources/node-express.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Guide : Python","permalink":"/fr/authorization/api-resources/python"},"next":{"title":"Guide : Spring Boot","permalink":"/fr/authorization/api-resources/spring-boot"}}');var o=n(86070),i=n(15658);const a={sidebar_position:3},s="Guide : Node (Express)",d={},l=[{value:"\xc9tape 1 : Extraire le jeton Bearer de l&#39;en-t\xeate de la requ\xeate",id:"\xe9tape-1--extraire-le-jeton-bearer-de-len-t\xeate-de-la-requ\xeate",level:2},{value:"\xc9tape 2 : Validation du jeton",id:"\xe9tape-2--validation-du-jeton",level:2},{value:"Installer <code>jose</code> comme d\xe9pendance",id:"installer-jose-comme-d\xe9pendance",level:3},{value:"R\xe9cup\xe9rer les configurations OIDC de Logto",id:"r\xe9cup\xe9rer-les-configurations-oidc-de-logto",level:3},{value:"Ajouter un middleware d&#39;authentification",id:"ajouter-un-middleware-dauthentification",level:3},{value:"Appliquer le middleware \xe0 votre API",id:"appliquer-le-middleware-\xe0-votre-api",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"guide--node-express",children:"Guide : Node (Express)"})}),"\n",(0,o.jsx)(t.h2,{id:"\xe9tape-1--extraire-le-jeton-bearer-de-len-t\xeate-de-la-requ\xeate",children:"\xc9tape 1 : Extraire le jeton Bearer de l'en-t\xeate de la requ\xeate"}),"\n",(0,o.jsxs)(t.p,{children:["Une requ\xeate autoris\xe9e doit contenir un en-t\xeate ",(0,o.jsx)(t.code,{children:"Authorization"})," avec ",(0,o.jsx)(t.code,{children:"Bearer <access_token>"})," comme contenu. Extraire le Jeton d\u2019Autorisation de l'en-t\xeate de la requ\xeate :"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"// auth_middleware.ts\n\nimport { IncomingHttpHeaders } from 'http';\n\nconst extractBearerTokenFromHeaders = ({ authorization }: IncomingHttpHeaders) => {\n  const bearerTokenIdentifier = 'Bearer';\n\n  if (!authorization) {\n    throw new Error({ code: 'auth.authorization_header_missing', status: 401 });\n  }\n\n  if (!authorization.startsWith(bearerTokenIdentifier)) {\n    throw new Error({ code: 'auth.authorization_token_type_not_supported', status: 401 });\n  }\n\n  return authorization.slice(bearerTokenIdentifier.length + 1);\n};\n"})}),"\n",(0,o.jsx)(t.h2,{id:"\xe9tape-2--validation-du-jeton",children:"\xc9tape 2 : Validation du jeton"}),"\n",(0,o.jsxs)(t.p,{children:["Pour la d\xe9monstration, nous utilisons le package ",(0,o.jsx)(t.a,{href:"https://github.com/panva/jose",children:"jose"})," pour valider la signature du jeton, son statut d'expiration et les revendications requises."]}),"\n",(0,o.jsxs)(t.h3,{id:"installer-jose-comme-d\xe9pendance",children:["Installer ",(0,o.jsx)(t.code,{children:"jose"})," comme d\xe9pendance"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"npm i jose --save\n"})}),"\n",(0,o.jsx)(t.h3,{id:"r\xe9cup\xe9rer-les-configurations-oidc-de-logto",children:"R\xe9cup\xe9rer les configurations OIDC de Logto"}),"\n",(0,o.jsxs)(t.p,{children:["Vous aurez besoin d'un ensemble de cl\xe9s publiques JWK et de l' \xc9metteur du jeton pour v\xe9rifier la signature et la source du jeton JWS re\xe7u. Toutes les derni\xe8res configurations publiques d'Autorisation Logto peuvent \xeatre trouv\xe9es \xe0 ",(0,o.jsx)(t.code,{children:"https://<your-logto-domain>/oidc/.well-known/openid-configuration"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["par exemple, appelez ",(0,o.jsx)(t.code,{children:"https://tenant-id.logto.app/oidc/.well-known/openid-configuration"}),". Et localisez les deux champs suivants dans le corps de la r\xe9ponse :"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "jwks_uri": "https://tenant-id.logto.app/oidc/jwks",\n  "issuer": "https://tenant-id.logto.app/oidc"\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"ajouter-un-middleware-dauthentification",children:"Ajouter un middleware d'authentification"}),"\n",(0,o.jsxs)(t.p,{children:["La m\xe9thode ",(0,o.jsx)(t.code,{children:"jwtVerify"})," de Jose peut vous aider \xe0 v\xe9rifier le format JWS du jeton, la signature du jeton, l' \xc9metteur, l' Audience et le statut d'expiration. Une exception sera lev\xe9e si la validation \xe9choue."]}),"\n",(0,o.jsx)(t.admonition,{type:"warning",children:(0,o.jsxs)(t.p,{children:["Si vous utilisez le ",(0,o.jsx)(t.a,{href:"/authorization/role-based-access-control/protect-api-resources-with-rbac",children:"contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC)"}),", la validation de la port\xe9e est \xe9galement requise."]})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"// auth-middleware.ts\n\nimport { createRemoteJWKSet, jwtVerify } from 'jose';\n\n//...\n\nexport const verifyAuthFromRequest = async (req, res, next) => {\n  // Extraire le jeton\n  const token = extractBearerTokenFromHeaders(req.headers);\n\n  const { payload } = await jwtVerify(\n    token, // Le jeton Bearer brut extrait de l'en-t\xeate de la requ\xeate\n    createRemoteJWKSet(new URL('https://<your-logto-domain>/oidc/jwks')), // g\xe9n\xe9rer un jwks en utilisant jwks_uri demand\xe9 depuis le serveur Logto\n    {\n      // \xc9metteur attendu du jeton, doit \xeatre \xe9mis par le serveur Logto\n      issuer: 'https://<your-logto-domain>/oidc',\n      // Jeton d\u2019audience attendu, doit \xeatre l'indicateur de ressource de l'API actuelle\n      audience: '<your request listener resource indicator>',\n    }\n  );\n\n  // si vous utilisez le RBAC\n  assert(payload.scope.includes('some_scope'));\n\n  // logique de charge utile personnalis\xe9e\n  userId = payload.sub;\n\n  return next();\n};\n"})}),"\n",(0,o.jsx)(t.h2,{id:"appliquer-le-middleware-\xe0-votre-api",children:"Appliquer le middleware \xe0 votre API"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"import { verifyAuthFromRequest } from '/middleware/auth-middleware.ts';\n\napp.get('/user/:id', verifyAuthFromRequest, (req, res, next) => {\n  // Code personnalis\xe9\n});\n"})})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},15658:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>s});var r=n(30758);const o={},i=r.createContext(o);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);