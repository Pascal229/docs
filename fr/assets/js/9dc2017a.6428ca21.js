"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[24018],{525:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>g,frontMatter:()=>l,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"authorization/organization-template/protect-organization-resources","title":"Prot\xe9ger les ressources de l\'organisation","description":"En plus de Prot\xe9ger votre API qui prend l\'API comme ressource, l\'organisation peut \xe9galement \xeatre une ressource, et prot\xe9ger votre ressource d\'organisation de la m\xeame mani\xe8re. Dans cet article, nous nous concentrerons sur la fa\xe7on de changer pour prot\xe9ger votre ressource d\'organisation de mani\xe8re similaire.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-organization-resources.mdx","sourceDirName":"authorization/organization-template","slug":"/authorization/organization-template/protect-organization-resources","permalink":"/fr/authorization/organization-template/protect-organization-resources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-organization-resources.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Configurer le mod\xe8le d\'organisation","permalink":"/fr/authorization/organization-template/configure-organization-template"},"next":{"title":"Prot\xe9ger la ressource API avec le mod\xe8le d\'organisation","permalink":"/fr/authorization/organization-template/protect-api-reources"}}');var r=o(86070),t=o(15658),a=o(78551),s=o(77501);const l={sidebar_position:2},c="Prot\xe9ger les ressources de l'organisation",d={},u=[{value:"\xc9tape 1 : Obtenir les identifiants d&#39;organisation \xe0 partir du flux OIDC",id:"\xe9tape-1--obtenir-les-identifiants-dorganisation-\xe0-partir-du-flux-oidc",level:2},{value:"Optionnel : Obtenir les r\xf4les d&#39;organisation",id:"optionnel--obtenir-les-r\xf4les-dorganisation",level:3},{value:"\xc9tape 2. R\xe9cup\xe9rer le jeton d&#39;organisation",id:"\xe9tape-2-r\xe9cup\xe9rer-le-jeton-dorganisation",level:2},{value:"Ajouter des param\xe8tres \xe0 la requ\xeate d&#39;authentification",id:"ajouter-des-param\xe8tres-\xe0-la-requ\xeate-dauthentification",level:3},{value:"R\xe9cup\xe9rer le jeton d&#39;organisation",id:"r\xe9cup\xe9rer-le-jeton-dorganisation",level:3},{value:"Exemple",id:"exemple",level:3},{value:"R\xe9cup\xe9rer le jeton d&#39;organisation pour une application machine-\xe0-machine",id:"r\xe9cup\xe9rer-le-jeton-dorganisation-pour-une-application-machine-\xe0-machine",level:3},{value:"\xc9tape 3. V\xe9rifier les jetons d&#39;organisation",id:"\xe9tape-3-v\xe9rifier-les-jetons-dorganisation",level:2}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"prot\xe9ger-les-ressources-de-lorganisation",children:"Prot\xe9ger les ressources de l'organisation"})}),"\n",(0,r.jsxs)(n.p,{children:["En plus de ",(0,r.jsx)(n.a,{href:"/authorization/api-resources/protect-your-api",children:"Prot\xe9ger votre API"})," qui prend l'API comme ressource, l'organisation peut \xe9galement \xeatre une ressource, et prot\xe9ger votre ressource d'organisation de la m\xeame mani\xe8re. Dans cet article, nous nous concentrerons sur la fa\xe7on de changer pour prot\xe9ger votre ressource d'organisation de mani\xe8re similaire."]}),"\n",(0,r.jsx)(n.mermaid,{value:'sequenceDiagram\n    participant Client\n    participant Logto\n    participant API\n\n    %% Standard OIDC Flow\n    Note over Client,Logto: Flux OIDC standard\n    Client->>Logto: Requ\xeate d\u2019Autorisation\n    Note right of Client: Inclut les port\xe9es d\u2019organisation :<br/>"urn:logto:scope:organizations"\n    Logto->>Client: Code d\u2019Autorisation\n    Client->>Logto: Requ\xeate de Jeton\n    Logto->>Client: Jeton d\u2019identifiant + Jeton d\u2019acc\xe8s\n    Note right of Client: Le Jeton d\u2019identifiant contient `organizations`\n\n    %% Requ\xeate de Jeton d\u2019Organisation\n    Note over Client,API: Requ\xeate de Jeton d\u2019Organisation\n    Client->>Logto: POST /oidc/token\n    Note right of Client: avec la ressource "urn:logto:scope:organizations"<br/>et les port\xe9es demand\xe9es incluant<br/>"urn:logto:scope:organizations"\n    Note right of Client: inclut le param\xe8tre organization_id\n\n    Note over Logto: V\xe9rifier l\'acc\xe8s de l\'utilisateur \xe0 l\'organisation\n\n    alt Pas d\'acc\xe8s \xe0 organization_id\n        Logto--\x3e>Client: 403 Interdit\n    else A acc\xe8s \xe0 l\'organisation\n        Note over Logto: Filtrer les port\xe9es demand\xe9es\n        Logto--\x3e>Client: Retourne le jeton d\u2019acc\xe8s JWT\n        Note left of Logto: Le jeton contient :<br/>- Revendications JWT standard<br/>- Port\xe9es accord\xe9es<br/>- audience `urn:logto:organization:{organization_id}`\n    end\n\n    Note over Client,API: Requ\xeate API\n    Client->>API: Requ\xeate avec jeton Bearer (jeton d\u2019organisation JWT)\n\n    Note over API: Valider le jeton JWT :<br/>- Validation JWT standard<br/>- V\xe9rifier organization_id\n\n    alt Jeton invalide\n        API--\x3e>Client: 401 Non autoris\xe9\n    else Jeton valide\n        alt organization_id invalide\n            API--\x3e>Client: 403 Interdit\n        else organization_id valide\n            API--\x3e>Client: Ressource prot\xe9g\xe9e\n        end\n    end'}),"\n",(0,r.jsx)(n.h2,{id:"\xe9tape-1--obtenir-les-identifiants-dorganisation-\xe0-partir-du-flux-oidc",children:"\xc9tape 1 : Obtenir les identifiants d'organisation \xe0 partir du flux OIDC"}),"\n",(0,r.jsxs)(n.p,{children:["Logto \xe9tend le protocole standard ",(0,r.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect"})," pour permettre \xe0 votre application d'obtenir les informations de l'organisation de l'utilisateur. Il existe deux fa\xe7ons de le faire :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Si vous utilisez un SDK Logto avec prise en charge des Organisations, vous pouvez ajouter la port\xe9e ",(0,r.jsx)(n.code,{children:"urn:logto:scope:organizations"})," au param\xe8tre ",(0,r.jsx)(n.code,{children:"scopes"})," de l'objet de configuration. Habituellement, le SDK aura un enum pour cette port\xe9e, par exemple ",(0,r.jsx)(n.code,{children:"UserScope.Organizations"})," dans les ",(0,r.jsx)(n.a,{href:"https://github.com/logto-io/js",children:"SDK Logto JS"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.A,{groupId:"sdk",children:[(0,r.jsx)(a.A,{value:"js",label:"JavaScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import { LogtoClient, UserScope } from '@logto/browser'; // ou @logto/node, @logto/client\n\nconst logto = new LogtoClient({\n  // ...\n  scopes: [UserScope.Organizations],\n});\n"})})}),(0,r.jsx)(a.A,{value:"react",label:"React",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { LogtoProvider, UserScope } from '@logto/react';\n\nconst App = () => (\n  <LogtoProvider\n    config={{\n      // ...\n      scopes: [UserScope.Organizations],\n    }}\n  >\n    {/* ... */}\n  </LogtoProvider>\n);\n"})})}),(0,r.jsx)(a.A,{value:"python",label:"Python",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"from logto import UserInfoScope\n\nclient = LogtoClient(\n    LogtoConfig(\n        # ...\n        scopes=[UserInfoScope.organizations],\n    )\n)\n"})})}),(0,r.jsx)(a.A,{value:"php",label:"PHP",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"use Logto\\Sdk\\Constants\\UserScope;\n\n$client = new LogtoClient(\n  new LogtoConfig(\n    // ...\n    scopes: [UserScope::organizations],\n  )\n);\n"})})}),(0,r.jsx)(a.A,{value:"swift",label:"Swift",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:"import Logto\nimport LogtoClient\n\nlet config = try? LogtoConfig(\n    // ...\n    scopes: [\n        UserScope.organizations.rawValue,\n    ],\n    // ...\n)\nlet client = LogtoClient(useConfig: config)\n"})})}),(0,r.jsx)(a.A,{value:"others",label:"Autres",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = {\n  // ...\n  scope: 'openid offline_access urn:logto:scope:organizations',\n};\n"})})})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pour d'autres cas, vous devez ajouter la port\xe9e ",(0,r.jsx)(n.code,{children:"urn:logto:scope:organizations"})," au param\xe8tre ",(0,r.jsx)(n.code,{children:"scope"})," de la configuration du SDK (ou de la requ\xeate d'authentification)."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Une fois que l'utilisateur a termin\xe9 le flux d'authentification, vous pouvez obtenir les informations de l'organisation \xe0 partir du ",(0,r.jsx)(n.code,{children:"idToken"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// Utiliser JavaScript comme exemple\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organizations); // Un tableau de cha\xeenes d'identifiants d'organisation\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Le champ ",(0,r.jsx)(n.code,{children:"organizations"})," (revendication) sera \xe9galement inclus dans la r\xe9ponse du ",(0,r.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo",children:"point de terminaison UserInfo"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"optionnel--obtenir-les-r\xf4les-dorganisation",children:"Optionnel : Obtenir les r\xf4les d'organisation"}),"\n",(0,r.jsxs)(n.p,{children:["Si vous n'avez pas encore configur\xe9 les r\xf4les d'organisation, consultez ",(0,r.jsx)(n.a,{href:"/authorization/organization-template/configure-organization-template/#create-organization-role",children:"cette section"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Pour obtenir tous les r\xf4les d'organisation de l'utilisateur actuel :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Si vous utilisez un SDK Logto avec prise en charge des Organisations, vous pouvez ajouter la port\xe9e ",(0,r.jsx)(n.code,{children:"urn:logto:scope:organization_roles"})," au param\xe8tre ",(0,r.jsx)(n.code,{children:"scopes"})," de l'objet de configuration. Habituellement, le SDK aura un enum pour cette port\xe9e, par exemple ",(0,r.jsx)(n.code,{children:"UserScope.OrganizationRoles"})," dans les ",(0,r.jsx)(n.a,{href:"https://github.com/logto-io/js",children:"SDK Logto JS"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Pour d'autres cas, vous devez ajouter la port\xe9e ",(0,r.jsx)(n.code,{children:"urn:logto:scope:organization_roles"})," au param\xe8tre ",(0,r.jsx)(n.code,{children:"scope"})," de la configuration du SDK (ou de la requ\xeate d'authentification)."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Ensuite, vous pouvez obtenir les r\xf4les d'organisation \xe0 partir du ",(0,r.jsx)(n.code,{children:"idToken"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// Utiliser JavaScript comme exemple\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organization_roles); // Un tableau de cha\xeenes de r\xf4les d'organisation\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Chaque cha\xeene dans le tableau est au format ",(0,r.jsx)(n.code,{children:"organization_id:role_id"}),", par exemple ",(0,r.jsx)(n.code,{children:"org_123:admin"})," signifie que l'utilisateur a le r\xf4le ",(0,r.jsx)(n.code,{children:"admin"})," dans l'organisation avec l'identifiant ",(0,r.jsx)(n.code,{children:"org_123"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Le champ ",(0,r.jsx)(n.code,{children:"organization_roles"})," (revendication) sera \xe9galement inclus dans la r\xe9ponse du ",(0,r.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo",children:"point de terminaison UserInfo"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"\xe9tape-2-r\xe9cup\xe9rer-le-jeton-dorganisation",children:"\xc9tape 2. R\xe9cup\xe9rer le jeton d'organisation"}),"\n",(0,r.jsx)(n.p,{children:"Pour effectuer des actions dans le contexte d'une organisation, l'utilisateur doit se voir accorder un jeton d\u2019acc\xe8s pour cette organisation (jeton d\u2019organisation). Le jeton d\u2019organisation est un jeton JWT qui contient l'identifiant de l'organisation et les permissions (port\xe9es) de l'utilisateur dans l'organisation."}),"\n",(0,r.jsx)(n.h3,{id:"ajouter-des-param\xe8tres-\xe0-la-requ\xeate-dauthentification",children:"Ajouter des param\xe8tres \xe0 la requ\xeate d'authentification"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Si vous utilisez un SDK Logto avec prise en charge des Organisations, vous pouvez ajouter la port\xe9e ",(0,r.jsx)(n.code,{children:"urn:logto:scope:organizations"})," au param\xe8tre ",(0,r.jsx)(n.code,{children:"scopes"})," de l'objet de configuration, de la m\xeame mani\xe8re que ",(0,r.jsx)(n.a,{href:"/authorization/organization-template/protect-organization-resources/#step-1-get-organization-ids-from-oidc-flow",children:"Obtenir les identifiants d'organisation de l'utilisateur actuel"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Le SDK Logto avec prise en charge des Organisations g\xe9rera automatiquement le reste de la configuration."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Pour d'autres cas, vous devez ajouter les port\xe9es ",(0,r.jsx)(n.code,{children:"offline_access"})," et ",(0,r.jsx)(n.code,{children:"urn:logto:scope:organizations"})," au param\xe8tre ",(0,r.jsx)(n.code,{children:"scope"})," et la ressource ",(0,r.jsx)(n.code,{children:"urn:logto:resource:organizations"})," au param\xe8tre ",(0,r.jsx)(n.code,{children:"resource"})," de la configuration du SDK (ou de la requ\xeate d'authentification).","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Remarque : ",(0,r.jsx)(n.code,{children:"offline_access"})," est requis pour obtenir le ",(0,r.jsx)(n.code,{children:"refresh_token"})," qui peut \xeatre utilis\xe9 pour r\xe9cup\xe9rer des jetons d'organisation."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// Uniquement pour d'autres cas. Pour les SDK Logto, voir ci-dessus.\nconst config = {\n  // ...\n  scope: 'openid offline_access urn:logto:scope:organizations',\n  resource: 'urn:logto:resource:organizations',\n};\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["La ressource ",(0,r.jsx)(n.code,{children:"urn:logto:resource:organizations"})," est une ressource sp\xe9ciale qui repr\xe9sente le mod\xe8le d'organisation."]})}),"\n",(0,r.jsx)(n.h3,{id:"r\xe9cup\xe9rer-le-jeton-dorganisation",children:"R\xe9cup\xe9rer le jeton d'organisation"}),"\n",(0,r.jsxs)(n.p,{children:["Logto \xe9tend le type de subvention standard ",(0,r.jsx)(n.code,{children:"refresh_token"})," pour permettre \xe0 votre application de r\xe9cup\xe9rer des jetons d'organisation."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Si vous utilisez un SDK Logto avec prise en charge des Organisations, vous pouvez appeler la m\xe9thode ",(0,r.jsx)(n.code,{children:"getOrganizationToken()"})," (ou la m\xe9thode ",(0,r.jsx)(n.code,{children:"getOrganizationTokenClaims()"}),") du SDK."]}),"\n",(0,r.jsxs)(n.li,{children:["Pour d'autres cas, vous devez appeler le point de terminaison du jeton avec les param\xe8tres suivants :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"grant_type"})," : ",(0,r.jsx)(n.code,{children:"refresh_token"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client_id"})," : L'identifiant de l'application que l'utilisateur a utilis\xe9 pour s'authentifier."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"refresh_token"})," : Le ",(0,r.jsx)(n.code,{children:"refresh_token"})," que vous avez obtenu du flux d'authentification."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"organization_id"})," : L'identifiant de l'organisation pour laquelle vous souhaitez obtenir le jeton."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"scope"})," (optionnel) : Les port\xe9es que vous souhaitez accorder \xe0 l'utilisateur dans l'organisation. Si non sp\xe9cifi\xe9, le serveur d'autorisation essaiera d'accorder les m\xeames port\xe9es que le flux d'authentification."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.A,{groupId:"sdk",children:[(0,r.jsx)(a.A,{value:"js",label:"JavaScript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const token = await logto.getOrganizationToken('<organization-id>');\n"})})}),(0,r.jsx)(a.A,{value:"react",label:"React",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const App = () => {\n  const { getOrganizationToken } = useLogto();\n\n  const getToken = async () => {\n    const token = await getOrganizationToken('<organization-id>');\n  };\n\n  return <button onClick={getToken}>Obtenir le jeton d'organisation</button>;\n};\n"})})}),(0,r.jsx)(a.A,{value:"python",label:"Python",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'token = await client.getOrganizationToken("<organization-id>")\n# ou\nclaims = await client.getOrganizationTokenClaims("<organization-id>")\n'})})}),(0,r.jsx)(a.A,{value:"php",label:"PHP",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$token = $client->getOrganizationToken('<organization-id>');\n// ou\n$claims = $client->getOrganizationTokenClaims('<organization-id>');\n"})})}),(0,r.jsx)(a.A,{value:"swift",label:"Swift",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:'let token = try await client.getOrganizationToken(forId: "<organization-id>")\n'})})}),(0,r.jsx)(a.A,{value:"others",label:"Autres",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// Utiliser JavaScript comme exemple\n\nconst params = new URLSearchParams();\n\nparams.append('grant_type', 'refresh_token');\nparams.append('client_id', 'YOUR_CLIENT_ID');\nparams.append('refresh_token', 'REFRESH_TOKEN');\nparams.append('organization_id', 'org_123');\n\nconst response = await fetch('https://YOUR_LOGTO_ENDPOINT/oidc/token', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/x-www-form-urlencoded',\n  },\n  body: params,\n});\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["La r\xe9ponse sera au m\xeame format que le ",(0,r.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#TokenEndpoint",children:"point de terminaison standard du jeton"}),", et le ",(0,r.jsx)(n.code,{children:"access_token"})," est le jeton d'organisation au format JWT."]}),"\n",(0,r.jsx)(n.p,{children:"En plus des revendications r\xe9guli\xe8res d'un jeton d\u2019acc\xe8s, le jeton d'organisation contient \xe9galement les revendications suivantes :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"aud"})," : L'audience du jeton d'organisation est ",(0,r.jsx)(n.code,{children:"urn:logto:organization:{organization_id}"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"scope"})," : Les port\xe9es accord\xe9es \xe0 l'utilisateur dans l'organisation avec un espace comme d\xe9limiteur."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"exemple",children:"Exemple"}),"\n",(0,r.jsx)(n.p,{children:"Un bon exemple peut valoir mille mots. Supposons que notre mod\xe8le d'organisation ait la configuration suivante :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Permissions : ",(0,r.jsx)(n.code,{children:"read:logs"}),", ",(0,r.jsx)(n.code,{children:"write:logs"}),", ",(0,r.jsx)(n.code,{children:"read:users"}),", ",(0,r.jsx)(n.code,{children:"write:users"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["R\xf4les : ",(0,r.jsx)(n.code,{children:"admin"}),", ",(0,r.jsx)(n.code,{children:"member"}),".","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Le r\xf4le ",(0,r.jsx)(n.code,{children:"admin"})," a toutes les permissions."]}),"\n",(0,r.jsxs)(n.li,{children:["Le r\xf4le ",(0,r.jsx)(n.code,{children:"member"})," a les permissions ",(0,r.jsx)(n.code,{children:"read:logs"})," et ",(0,r.jsx)(n.code,{children:"read:users"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Et l'utilisateur a la configuration suivante :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Identifiants d'organisation : ",(0,r.jsx)(n.code,{children:"org_1"}),", ",(0,r.jsx)(n.code,{children:"org_2"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["R\xf4les d'organisation : ",(0,r.jsx)(n.code,{children:"org_1:admin"}),", ",(0,r.jsx)(n.code,{children:"org_2:member"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Dans la configuration du SDK Logto (ou la requ\xeate d'authentification), nous avons configur\xe9 d'autres \xe9l\xe9ments correctement, et ajout\xe9 les port\xe9es suivantes :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"urn:logto:scope:organizations"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"openid"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"offline_access"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"read:logs"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"write:logs"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Maintenant, lorsque l'utilisateur termine le flux d'authentification, nous pouvons obtenir les identifiants d'organisation \xe0 partir du ",(0,r.jsx)(n.code,{children:"idToken"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// Utiliser JavaScript comme exemple\nconst idToken = await logto.getIdTokenClaims();\n\nconsole.log(idToken.organizations); // ['org_1', 'org_2']\n"})}),"\n",(0,r.jsx)(n.p,{children:"Si nous voulons obtenir les jetons d'organisation :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// Utiliser JavaScript comme exemple\nconst org1Token = await logto.getOrganizationTokenClaims('org_1');\nconst org2Token = await logto.getOrganizationTokenClaims('org_2');\n\nconsole.log(org1Token.aud); // 'urn:logto:organization:org_1'\nconsole.log(org1Token.scope); // 'read:logs write:logs'\nconsole.log(org2Token.aud); // 'urn:logto:organization:org_2'\nconsole.log(org2Token.scope); // 'read:logs'\n\nconst org3Token = await logto.getOrganizationTokenClaims('org_3'); // Erreur : L'utilisateur n'est pas membre de l'organisation\n"})}),"\n",(0,r.jsx)(n.p,{children:"Explication :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pour ",(0,r.jsx)(n.code,{children:"org_1"}),", l'utilisateur a le r\xf4le ",(0,r.jsx)(n.code,{children:"admin"}),", donc le jeton d'organisation devrait avoir toutes les permissions disponibles (port\xe9es)."]}),"\n",(0,r.jsxs)(n.li,{children:["Pour ",(0,r.jsx)(n.code,{children:"org_2"}),", l'utilisateur a le r\xf4le ",(0,r.jsx)(n.code,{children:"member"}),", donc le jeton d'organisation devrait avoir les permissions ",(0,r.jsx)(n.code,{children:"read:logs"})," et ",(0,r.jsx)(n.code,{children:"read:users"})," (port\xe9es)."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Puisque nous avons seulement demand\xe9 les port\xe9es ",(0,r.jsx)(n.code,{children:"read:logs"})," et ",(0,r.jsx)(n.code,{children:"write:logs"})," dans le flux d'authentification, les jetons d'organisation ont \xe9t\xe9 \"r\xe9duits\" en cons\xe9quence, r\xe9sultant en l'intersection des port\xe9es demand\xe9es et des port\xe9es disponibles."]}),"\n",(0,r.jsx)(n.h3,{id:"r\xe9cup\xe9rer-le-jeton-dorganisation-pour-une-application-machine-\xe0-machine",children:"R\xe9cup\xe9rer le jeton d'organisation pour une application machine-\xe0-machine"}),"\n",(0,r.jsxs)(n.p,{children:["Similaire \xe0 la r\xe9cup\xe9ration des jetons d'organisation pour les utilisateurs, vous pouvez \xe9galement r\xe9cup\xe9rer des jetons d'organisation pour des applications machine-\xe0-machine. La seule diff\xe9rence est que vous devez utiliser le type de subvention ",(0,r.jsx)(n.code,{children:"client_credentials"})," au lieu du type de subvention ",(0,r.jsx)(n.code,{children:"refresh_token"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Pour en savoir plus sur les applications machine-\xe0-machine, voir ",(0,r.jsx)(n.a,{href:"/quick-starts/m2m/",children:"Machine-to-machine : Auth avec Logto"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"\xe9tape-3-v\xe9rifier-les-jetons-dorganisation",children:"\xc9tape 3. V\xe9rifier les jetons d'organisation"}),"\n",(0,r.jsxs)(n.p,{children:["Une fois que l'application obtient un jeton d'organisation, elle peut utiliser le jeton de la m\xeame mani\xe8re qu'un jeton d\u2019acc\xe8s r\xe9gulier, par exemple appeler les API avec le jeton dans l'en-t\xeate ",(0,r.jsx)(n.code,{children:"Authorization"})," au format ",(0,r.jsx)(n.code,{children:"Bearer {token}"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Dans votre API, la fa\xe7on dont vous v\xe9rifiez le jeton d'organisation est assez similaire \xe0 ",(0,r.jsx)(n.a,{href:"/authorization/api-resources/protect-your-api/#validate-authorization-tokens-for-api-requests",children:"Prot\xe9ger votre API"}),". Principales diff\xe9rences :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Contrairement aux jetons d\u2019acc\xe8s pour les ressources API, un utilisateur NE PEUT PAS obtenir un jeton d'organisation si l'utilisateur n'est pas membre de l'organisation."}),"\n",(0,r.jsxs)(n.li,{children:["L'audience du jeton d'organisation est ",(0,r.jsx)(n.code,{children:"urn:logto:organization:{organization_id}"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Pour certaines permissions (port\xe9es), vous devez v\xe9rifier la revendication ",(0,r.jsx)(n.code,{children:"scope"})," du jeton d'organisation en divisant la cha\xeene avec un espace comme d\xe9limiteur."]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},78551:(e,n,o)=>{o.d(n,{A:()=>a});o(30758);var i=o(13526);const r={tabItem:"tabItem_PGP0"};var t=o(86070);function a(e){let{children:n,hidden:o,className:a}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,i.A)(r.tabItem,a),hidden:o,children:n})}},77501:(e,n,o)=>{o.d(n,{A:()=>k});var i=o(30758),r=o(13526),t=o(65052),a=o(25557),s=o(77469),l=o(50873),c=o(62230),d=o(60196);function u(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:o}=e;return(0,i.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:o,attributes:i,default:r}}=e;return{value:n,label:o,attributes:i,default:r}}))}(o);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,o])}function g(e){let{value:n,tabValues:o}=e;return o.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:o}=e;const r=(0,a.W6)(),t=function(e){let{queryString:n=!1,groupId:o}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!o)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return o??null}({queryString:n,groupId:o});return[(0,l.aZ)(t),(0,i.useCallback)((e=>{if(!t)return;const n=new URLSearchParams(r.location.search);n.set(t,e),r.replace({...r.location,search:n.toString()})}),[t,r])]}function j(e){const{defaultValue:n,queryString:o=!1,groupId:r}=e,t=p(e),[a,l]=(0,i.useState)((()=>function(e){let{defaultValue:n,tabValues:o}=e;if(0===o.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!g({value:n,tabValues:o}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${o.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const i=o.find((e=>e.default))??o[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:n,tabValues:t}))),[c,u]=h({queryString:o,groupId:r}),[j,m]=function(e){let{groupId:n}=e;const o=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,t]=(0,d.Dv)(o);return[r,(0,i.useCallback)((e=>{o&&t.set(e)}),[o,t])]}({groupId:r}),x=(()=>{const e=c??j;return g({value:e,tabValues:t})?e:null})();(0,s.A)((()=>{x&&l(x)}),[x]);return{selectedValue:a,selectValue:(0,i.useCallback)((e=>{if(!g({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),m(e)}),[u,m,t]),tabValues:t}}var m=o(13887);const x={tabList:"tabList_CGfx",tabItem:"tabItem_JX1E"};var f=o(86070);function v(e){let{className:n,block:o,selectedValue:i,selectValue:a,tabValues:s}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,t.a_)(),d=e=>{const n=e.currentTarget,o=l.indexOf(n),r=s[o].value;r!==i&&(c(n),a(r))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const o=l.indexOf(e.currentTarget)+1;n=l[o]??l[0];break}case"ArrowLeft":{const o=l.indexOf(e.currentTarget)-1;n=l[o]??l[l.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":o},n),children:s.map((e=>{let{value:n,label:o,attributes:t}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:e=>l.push(e),onKeyDown:u,onClick:d,...t,className:(0,r.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":i===n}),children:o??n},n)}))})}function b(e){let{lazy:n,children:o,selectedValue:t}=e;const a=(Array.isArray(o)?o:[o]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===t));return e?(0,i.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function z(e){const n=j(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",x.tabList),children:[(0,f.jsx)(v,{...n,...e}),(0,f.jsx)(b,{...n,...e})]})}function k(e){const n=(0,m.A)();return(0,f.jsx)(z,{...e,children:u(e.children)},String(n))}},15658:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>s});var i=o(30758);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);